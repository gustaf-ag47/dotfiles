#!/bin/bash

# Browser Launcher for Wayland/X11
# Handles proper browser launching in different display environments

set -euo pipefail

URL="${1:-}"

if [ -z "$URL" ]; then
    echo "Usage: browser-launcher <URL>"
    exit 1
fi

# Function to launch browser with proper environment
launch_browser() {
    local url="$1"
    
    # Try different browsers in order of preference
    browsers=(
        "firefox"
        "chromium"
        "google-chrome"
        "brave"
        "webkit2gtk-4.0"
    )
    
    for browser in "${browsers[@]}"; do
        if command -v "$browser" &> /dev/null; then
            echo "Opening $url with $browser"
            
            if [ -n "${WAYLAND_DISPLAY:-}" ]; then
                # Wayland environment
                case "$browser" in
                    "firefox")
                        env MOZ_ENABLE_WAYLAND=1 GDK_BACKEND=wayland firefox "$url" >/dev/null 2>&1 &
                        ;;
                    "chromium")
                        chromium --enable-features=UseOzonePlatform --ozone-platform=wayland "$url" >/dev/null 2>&1 &
                        ;;
                    "google-chrome")
                        google-chrome --enable-features=UseOzonePlatform --ozone-platform=wayland "$url" >/dev/null 2>&1 &
                        ;;
                    "brave")
                        brave --enable-features=UseOzonePlatform --ozone-platform=wayland "$url" >/dev/null 2>&1 &
                        ;;
                    *)
                        "$browser" "$url" >/dev/null 2>&1 &
                        ;;
                esac
            else
                # X11 fallback
                "$browser" "$url" >/dev/null 2>&1 &
            fi
            
            return 0
        fi
    done
    
    echo "Error: No suitable browser found"
    return 1
}

# Launch the browser
launch_browser "$URL"